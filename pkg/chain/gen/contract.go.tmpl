// Code generated - DO NOT EDIT.
// This file is a generated binding and any manual changes will be lost.

package contract

import (
	"strings"
	"sync"

	"github.com/ethereum/go-ethereum"
	ethereumabi "github.com/ethereum/go-ethereum/accounts/abi"
	"github.com/ethereum/go-ethereum/accounts/abi/bind"
	"github.com/ethereum/go-ethereum/accounts/keystore"
	"github.com/ethereum/go-ethereum/common"
	"github.com/ethereum/go-ethereum/core/types"

	"github.com/ipfs/go-log"

	"github.com/keep-network/keep-common/pkg/chain/ethereum/ethutil"
	"github.com/keep-network/keep-core/pkg/chain/gen/abi"
	"github.com/keep-network/keep-core/pkg/subscription"
)

// Create a package-level logger for this contract. The logger exists at
// package level so that the logger is registered at startup and can be
// included or excluded from logging at startup by name.
var {{.ShortVar}}Logger = log.Logger("keep-contract-{{.Class}}")

type {{.Class}} struct {
	contract          *abi.{{.AbiClass}}
	contractAddress   common.Address
	contractABI       *ethereumabi.ABI
	caller            bind.ContractCaller
	callerOptions     *bind.CallOpts
	transactorOptions *bind.TransactOpts
	errorResolver     *ethutil.ErrorResolver

	transactionMutex *sync.Mutex
}

func New{{.Class}}(
    contractAddress common.Address,
    accountKey *keystore.Key,
    backend bind.ContractBackend,
    transactionMutex *sync.Mutex,
) (*{{.Class}}, error) {
	callerOptions := &bind.CallOpts{
		From: contractAddress,
	}
	transactorOptions := bind.NewKeyedTransactor(
		accountKey.PrivateKey,
	)

	randomBeaconContract, err := abi.New{{.AbiClass}}(
		contractAddress,
		backend,
	)
	if err != nil {
		return nil, fmt.Errorf(
			"failed to instantiate contract at address: %s [%v]",
			contractAddress.String(),
			err,
		)
	}

	contractABI, err := ethereumabi.JSON(strings.NewReader(abi.{{.AbiClass}}ABI))
	if err != nil {
		return nil, fmt.Errorf("failed to instantiate ABI: [%v]", err)
	}

	return &{{.Class}}{
		contract:          randomBeaconContract,
		contractAddress:   contractAddress,
		contractABI: 	   &contractABI,
		caller:     	   backend,
		callerOptions:     callerOptions,
		transactorOptions: transactorOptions,
		errorResolver:     ethutil.NewErrorResolver(backend, &contractABI, &contractAddress),
		transactionMutex:  transactionMutex,
	}, nil
}

// ----- Non-const Methods ------
{{template "contract_non_const_methods.go.tmpl" .}}

// ----- Const Methods ------
{{template "contract_const_methods.go.tmpl" .}}

// ------ Events -------
{{template "contract_events.go.tmpl" . -}}
